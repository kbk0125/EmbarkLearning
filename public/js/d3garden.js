var tomatoes = [
    {"width": 25, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "red"},
    {"width": 25, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "red"},
    {"width": 25, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "red"},
    {"width": 25, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "red"},
    {"width": 25, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "red"},
    {"width": 25, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "red"},
    {"width": 25, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "red"},
    {"width": 25, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "red"},
    {"width": 25, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "red"},
    {"width": 25, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "red"},
    {"width": 25, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "red"},
    {"width": 25, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "red"},
    {"width": 25, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "red"},
    {"width": 25, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "red"},
    {"width": 25, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "red"},
    {"width": 25, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "red"},
    {"width": 25, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "red"},
    {"width": 25, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "red"},
    {"width": 25, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "red"},
    {"width": 25, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "red"}
]

var peppers =[
    {"width": 20, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "yellow"},
    {"width": 20, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "yellow"},
    {"width": 20, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "yellow"},
    {"width": 20, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "yellow"},
    {"width": 20, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "yellow"},
    {"width": 20, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "yellow"},
    {"width": 20, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "yellow"},
    {"width": 20, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "yellow"},
    {"width": 20, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "yellow"},
    {"width": 20, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "yellow"},
    {"width": 20, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "yellow"},
    {"width": 20, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "yellow"},
    {"width": 20, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "yellow"},
    {"width": 20, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "yellow"},
    {"width": 20, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "yellow"},
    {"width": 20, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "yellow"},
    {"width": 20, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "yellow"},
    {"width": 20, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "yellow"},
    {"width": 20, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "yellow"},
    {"width": 20, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "yellow"}
]

var cucumbers =[
    {"width": 20, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "green"},
    {"width": 20, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "green"},
    {"width": 20, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "green"},
    {"width": 20, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "green"},
    {"width": 20, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "green"},
    {"width": 20, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "green"},
    {"width": 20, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "green"},
    {"width": 20, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "green"},
    {"width": 20, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "green"},
    {"width": 20, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "green"},
    {"width": 20, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "green"},
    {"width": 20, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "green"},
    {"width": 20, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "green"},
    {"width": 20, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "green"},
    {"width": 20, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "green"},
    {"width": 20, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "green"},
    {"width": 20, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "green"},
    {"width": 20, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "green"},
    {"width": 20, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "green"},
    {"width": 20, "height": Math.floor(Math.random() * (100 - 60 + 1)) + 60, "color": "green"}
]

var boxWidth;
var boxHeight;
var activeData;
var activePlant;
var holeTotal;
var widthLim;
var heightLim;
var boxRat;
var boxArea;
var newHeight;
var newWidth;

$('.backBtn').click(function(){
    prevSide(this)
})

function nextSide(prev){
    var par= $(prev).parents('.sideSect')
    $(par).hide();
    $(par).next().show()
    $('#main').children('.uniqData').hide()
}

function prevSide(prev){
    var par= $(prev).parents('.sideSect')
    $(par).hide();
    $(par).prev().show()
}

$('.resize').resizable({
    animate:true,
    containment: '#main',
    disabled: true,
    helper: "ui-resizable-helper",
    resize: function( event, ui ) {
        $('#dimensions').text('Garden Dimensions: '+ ui.size.width+'px x '+ui.size.height+'px')
        boxWidth= Math.round(ui.size.width)
        boxHeight= Math.round(ui.size.height -10)
    }
})

$('#topBar img').click(function(){
    window.location.reload()
})

$('.startbtn').click(function(){
    $(this).parents('.intro').fadeOut();
})

$('.norm').click(function(){
    nextSide(this)
})

$('.begin').click(function(){
    nextSide(this)
    $('.resize').css('opacity', '1')
    $('.resize').resizable('enable')
})

$('.svgTrig').click(function(){
    // 390 accounts for padding dimensions rather than 400
    if(boxWidth > 390 && boxHeight > 390){
        nextSide(this)
        $('.resize').resizable('disable')
        $('.resize').children('h3').remove()
        $('.resize').children('p').remove()
        $('.resize').css('background', '#c49a6c')
        $('#boxWidth').text('Declare a width of '+boxWidth+'px')
        $('#boxHeight').text('Declare a height of '+boxHeight+'px')
    }
    else{
        $(this).siblings('.warn').show();
    }
})

$('.valid').click(function(){
    var selectState= $("#svg1").val().indexOf("gardenDiv") > -1
    var appendState= $("#svg2").val().indexOf("svg") > -1
    var widthState= $("#svg3").val().indexOf(boxWidth) > -1
    var heightState= $("#svg4").val().indexOf(boxHeight) > -1

    if(selectState && appendState && widthState && heightState){
        nextSide(this)
        $('.graph').css('border', '1px solid #404040')
    }
    else{
        $(this).siblings('.warn').show();
    }
})

$('.valid2').click(function(){
    var allState= $('#select1').val().indexOf('rect.colorBar') > -1

    if(allState){
        nextSide(this)
        //determine nuber that can fit in across row
        widthLim= Math.floor(boxWidth/80) -1

        //determine number of rows, 69 is height + padding
        heightLim= Math.floor(boxHeight/69)

        holeTotal= widthLim*heightLim
        for(var i=0; i<holeTotal; i++){
            $('.resize').children('.holes').append('<div><img class="hole" src="/img/d3garden/hole.png"></div>')
        }
        //ratio of width to height
        boxRat= boxWidth/boxHeight
        //split entire thing into 20 equal areas
        boxArea=Math.sqrt(boxWidth*boxHeight/20)
        //ratio one way
        newHeight= boxArea/boxRat
        //with 20% reduction to make sure it fits
        newWidth= boxArea*boxRat*0.8
    }
    else{
        $(this).siblings('.warn').show();
    }
})

$('.seedTrig').click(function(){
    var keyTxt= $(this).siblings('p').text().toLowerCase()
    var classN= eval(keyTxt)
    activeData = keyTxt.replace(/\s+/g, '')
    activePlant = $(this).data('name')

    $('.uniqData').append('<p> var '+keyTxt+' = [</p>')
    for(var i=0; i<classN.length; i++){
        $('.uniqData').append('<p class="indent">'+JSON.stringify(classN[i])+',</p>')
    }
    $('.uniqData').append('<p>]</p>')
    $('#seedId').text('Add the data contained in the variable '+activeData)
})

$('.valid3').click(function(){
    var dataState= $("#data1").val().indexOf(activeData) > -1

    if(dataState){
        nextSide(this)
    }
    else{
        $(this).siblings('.warn').show();
    }
})

$('.valid4').click(function(){
    var enterState= $("#enter1").val().indexOf('enter') > -1

    if(enterState){
        nextSide(this)

        for(var i=0; i<20; i++){
            $('.resize').children('.seeds').append('<div><img class="seed" src="/img/d3garden/seeds.png"></div>')
        }
        for(var j=holeTotal; j>20; j--){
            $('.resize').children('.holes').children().eq(i).remove()
        }
        $('.resize').children('.holes').children('div').addClass('absoluted').width(newWidth).height(newHeight)
        $('.resize').children('.seeds').children('div').width(newWidth).height(newHeight);
    }
    else{
        $(this).siblings('.warn').show();
    }
})

$('.valid5').click(function(){
    var appendState= $("#append1").val().indexOf('rect') > -1

    if(appendState){
        nextSide(this)

        $('.resize').children('.seeds').children('div').remove()
        $('.resize').children('.holes').children('div').remove()

        for(var i=0; i<20; i++){
            $('.resize').children('.struct').append('<div><img class="structure" src="/img/d3garden/woodstand.png"></div>')
        }
        $('.resize').children('.struct').children('div').width(newWidth).height(newHeight)
    }
    else{
        $(this).siblings('.warn').show();
    }
})

$('.valid6').click(function(){
    var widthState= $("#width1").val().indexOf('return') > -1

    if(widthState){
        nextSide(this)
    }
    else{
        $(this).siblings('.warn').show();
    }
})

$('.valid7').click(function(){
    var heightState= $("#height1").val().indexOf('return') > -1

    if(heightState){
        nextSide(this)
        $('.graph').css('border', 'none')
        d3step1()
        for(var i=0; i<1; i++){
            $('.resize').children('.plant').append('<div><img class="eachplant" src="/img/d3garden/'+activePlant+'plant.png"></div>')
        }
        $('.resize').children('.plant').children('div').width(newWidth).height(newHeight)
    }
    else{
        $(this).siblings('.warn').show();
    }
})

$('.valid8').click(function(){
    var xState= $("#x1").val().indexOf('d.width') > -1

    if(xState){
        nextSide(this)
        $('.graph').html('')
        d3step2()
        $('.resize').children('.plant').children('div').remove()
        for(var i=0; i<20; i++){
            $('.resize').children('.plant').append('<div><img class="eachplant" src="/img/d3garden/'+activePlant+'plant.png"></div>')
        }
        $('.resize').children('.plant').children('div').width(newWidth).height(newHeight)
    }
    else{
        $(this).siblings('.warn').show();
    }
})

$('.valid9').click(function(){
    var yState= $("#y1").val().indexOf('d.height') > -1

    if(yState){
        nextSide(this)
        $('.graphProg').hide()
        runD3(eval(activeData))
        $('.resize').hide()
        $('.gardenDiv').show()
    }
    else{
        $(this).siblings('.warn').show();
    }
})

$('.displayObj').click(function(){
    $('#main').children('.uniqData').show()
})

function runD3(data){
    var w= 535
    var h= 250
    var svg= d3.select('.gardenDiv').append('svg')
        .attr('width', w)
        .attr('height', h);

    svg.selectAll('rect.colorBar')
        .data(data)
        .enter()
        .append('rect')
        .attr('width', function(d,i){return d.width})
        .attr('height', function(d,i){return d.height*2})
        .attr('x', function(d,i){return i * (d.width+2)})
        .attr('y', function(d,i){return h - d.height*2})
        .attr('fill', 'white')
}

function runD3pt2(data){
    var w= 535
    var h= 250
    var svg= d3.select('.gardenDiv').append('svg')
        .attr('width', w)
        .attr('height', h);

    svg.selectAll('rect.colorBar')
        .data(data)
        .enter()
        .append('rect')
        .attr('width', function(d,i){return d.width})
        .attr('height', function(d,i){return d.height*2})
        .attr('x', function(d,i){return i * (d.width+2)})
        .attr('y', function(d,i){return h - d.height*2})
        .attr('fill', 'white')

    var xScale = d3.scale.linear()
        .domain( [0, data.length] )
        .range( [0, w] );

    var yScale = d3.scale.linear()
        .domain( [0, d3.max(data, function(d) { return d.height; })] )
        .range( [0, h] );

    var xAxis = d3.svg.axis().scale(xScale).ticks(0)
    var yAxis = d3.svg.axis().scale(yScale).orient("left").ticks(0)

    svg.append("g").attr("transform", "translate(5,0)").call(yAxis);

    svg.append("g").attr("transform", "translate(0," + (h-5) + ")").call(xAxis);
}

function d3step1(){
    var w= 292
    var h= 74
    var svg= d3.select('.graph').append('svg')
        .attr('width', w)
        .attr('height', h);

    svg.selectAll('rect.colorBar')
        .data(tomatoes)
        .enter()
        .append('rect')
        .attr('width', function(d,i){return d.width/1.5})
        .attr('height', function(d,i){return d.height/1.5})
}

function d3step2(){
    var w= 292
    var h= 74
    var svg= d3.select('.graph').append('svg')
        .attr('width', w)
        .attr('height', h);

    svg.selectAll('rect.colorBar')
        .data(tomatoes)
        .enter()
        .append('rect')
        .attr('width', function(d,i){return d.width/1.5})
        .attr('height', function(d,i){return d.height/1.5})
        .attr('x', function(d,i){return i * (d.width+2)})
}

function d3step3(){
    var w= 292
    var h= 74
    var svg= d3.select('.graph').append('svg')
        .attr('width', w)
        .attr('height', h);

    svg.selectAll('rect.colorBar')
        .data(tomatoes)
        .enter()
        .append('rect')
        .attr('width', function(d,i){return d.width/1.5})
        .attr('height', function(d,i){return d.height/1.5})
        .attr('x', function(d,i){return i * (d.width+2)})
        .attr('y', function(d,i){return h - (d.height/1.5)})
}

$('.axesStart').click(function(){
    $('.graphProg').show()
    $('.resize').show()
    $('.gardenDiv').hide()
    nextSide(this)
    $('.graph').html('')
    d3step3()
})

$('.valid10').click(function(){
    var xState1= $("#xscale1").val().indexOf('d3.scale.linear()') > -1
    var xState2= $("#xscale2").val().indexOf('data.length') > -1
    var xState3= $("#xscale3").val().indexOf('.range') > -1

    if(xState1 && xState2 && xState3){
        nextSide(this)
    }
    else{
        $(this).siblings('.warn').show();
    }
})

$('.valid11').click(function(){
    var yState1= $("#yscale1").val().indexOf('d3.scale.linear()') > -1
    var yState2= $("#yscale2").val().indexOf('d3.max') > -1
    var yState3= $("#yscale3").val().indexOf('.range') > -1

    if(yState1 && yState2 && yState3){
        nextSide(this)
    }
    else{
        $(this).siblings('.warn').show();
    }
})

$('.valid12').click(function(){
    var xaxis1= $("#xaxis1").val().indexOf('d3.svg.axis()') > -1
    var xaxis2= $("#xaxis2").val().indexOf('.scale(xScale)') > -1

    if(xaxis1 && xaxis2){
        nextSide(this)
    }
    else{
        $(this).siblings('.warn').show();
    }
})

$('.valid13').click(function(){
    var xaxis3= $("#xaxis3").val().indexOf('.append') > -1
    var xaxis4= $("#xaxis4").val().indexOf('xAxis') > -1

    if(xaxis3 && xaxis4){
        nextSide(this)
        $('.resize').append("<img class='topLine' src='/img/fencehoriz.png'/>")
    }
    else{
        $(this).siblings('.warn').show();
    }
})

$('.valid14').click(function(){
    var yaxis1= $("#yaxis1").val().indexOf('d3.svg.axis()') > -1
    var yaxis2= $("#yaxis2").val().indexOf('.scale(yScale)') > -1

    if(yaxis1 && yaxis2){
        nextSide(this)
    }
    else{
        $(this).siblings('.warn').show();
    }
})

$('.valid15').click(function(){
    var yaxis3= $("#yaxis3").val().indexOf('.append') > -1
    var yaxis4= $("#yaxis4").val().indexOf('yAxis') > -1

    if(yaxis3 && yaxis4){
        nextSide(this)
        $('.resize').append("<img class='leftLine' src='/img/fencevert.png'/>")
    }
    else{
        $(this).siblings('.warn').show();
    }
})

$('.valid16').click(function(){
    var xaxis5= $("#xaxis5").val().indexOf('translate') > -1

    if(xaxis5){
        nextSide(this)
        $('.graphProg').hide()
        $('.gardenDiv').html('')
        runD3pt2(eval(activeData))
        $('.resize').hide()
        $('.gardenDiv').show()
    }
    else{
        $(this).siblings('.warn').show();
    }
})